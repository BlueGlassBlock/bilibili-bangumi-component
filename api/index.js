const isMock = false
function u(s){return Object.entries(s).filter(([,t])=>!!t).map(([t,e])=>`${t}=${e}`).join("&")}function m(s){return Object.fromEntries(Array.from(s.searchParams.entries()).filter(([,t])=>!!t))}function c(s){let t=s.toString();if(t.length<5)return t;if(t.length<9){let n=t.slice(0,-3),o=n.length,i=n[o-1]==="0"?"":`.${n[o-1]}`;return`${n.slice(0,o-1)}${i}\u4E07`}let e=t.slice(0,-7),r=e.length,a=e[r-1]==="0"?"":`.${e[r-1]}`;return`${e.slice(0,r-1)}${a}\u4EBF`}var{BILIBILI:h}=process.env;async function b(s){let{collectionType:t="0",uid:e="412686493",pageNumber:r="1",pageSize:a="10"}=s,n=e??h;if(!n)return Response.json({code:400,message:"uid is required",data:{}},{status:400});let o=u({type:1,follow_status:t,pn:r,ps:a,vmid:n}),i=await fetch(`https://api.bilibili.com/x/space/bangumi/follow/list?${o}`),l=await i.json();return i.ok?Response.json({code:200,message:"ok",data:d(l.data)}):Response.json({code:502,message:l.message,data:{}},{status:502})}function d(s){return{list:s?.list?.map(e=>{let r=[{label:e?.new_ep?.index_show},{label:"\u8BC4\u5206",value:e?.rating?.score},{label:"\u64AD\u653E\u91CF",value:e?.stat?.view&&c(e.stat.view)},{label:"\u8FFD\u756A\u6570",value:e?.stat?.follow&&c(e.stat.follow)},{label:"\u6295\u5E01\u6570",value:e?.stat?.coin&&c(e.stat.coin)},{label:"\u5F39\u5E55\u6570",value:e?.stat?.danmaku&&c(e.stat.danmaku)}];return{nameCN:e.title,summary:e.summary,cover:e.cover,url:e.url,labels:r.filter(a=>a.label)}})??[],pageNumber:s.pn,pageSize:s.ps,total:s.total,totalPages:Math.ceil(s.total/s.ps)}}var{BGM:f}=process.env,y={1:"2",2:"4"},j={0:null,1:"1",2:"3",3:"2"};async function g(s){let{subjectType:t="1",uid:e,collectionType:r="0",pageNumber:a=1,pageSize:n=10}=s,o=e??f;if(!o)return Response.json({code:400,message:"uid is required",data:{}},{status:400});let i=u({subject_type:y[t],type:j[r],limit:n,offset:(Number(a)-1)*Number(n)}),l=await fetch(`https://api.bgm.tv/v0/users/${o}/collections?${i}`,{headers:{"User-Agent":"yixiaojiu/bilibili-bangumi-component (https://github.com/yixiaojiu/bilibili-bangumi-component)"}}),p=await l.json();return l.ok?Response.json({code:200,message:"ok",data:v(p,{pageNumber:a,pageSize:n})}):Response.json({code:502,message:p.description},{status:500})}function v(s,t){return{list:s?.data?.map(r=>{let a=r?.subject,n=[{label:a?.eps&&`${a.eps}\u8BDD`},{label:"\u8BC4\u5206",value:a?.score},{label:"\u6392\u540D",value:a?.rank}];return{name:a?.name,nameCN:a?.name_cn,summary:a?.short_summary,cover:a?.images?.large,url:a?.id?`https://bgm.tv/subject/${a?.id}`:"https://bgm.tv/",labels:n.filter(o=>o.label)}})??[],...t,total:s.total,totalPages:Math.ceil(s.total/t.pageSize)}}var P="edge",z=["hkg1","hnd1","kix1","sin1"];async function D(s){let t=new URL(s.url),e=m(t);return isMock?t.pathname.endsWith("bilibili")?Response.json(mockDataMap.bilibili):Response.json(mockDataMap.bgm):t.pathname.endsWith("bilibili")?await b(e):await g(e)}export{D as GET,z as preferredRegion,P as runtime};
